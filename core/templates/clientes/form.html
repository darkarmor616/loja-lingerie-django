{% extends 'core/base.html' %}

{% block title %}{% if cliente %}Editar{% else %}Novo{% endif %} Cliente - Loja de Lingerie{% endblock %}

{% block content %}
<div class="card">
    <h2>{% if cliente %}‚úèÔ∏è Editar Cliente{% else %}‚ûï Novo Cliente{% endif %}</h2>
    
    <form method="POST">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="nome_cliente">Nome Completo: *</label>
            <input 
                type="text" 
                id="nome_cliente" 
                name="nome_cliente" 
                value="{{ cliente.nome_cliente|default:'' }}"
                required
                maxlength="100"
                placeholder="Ex: Maria Silva Santos">
        </div>
        
        <div class="form-group">
            <label for="cpf">CPF: *</label>
            <input 
                type="text" 
                id="cpf" 
                name="cpf" 
                value="{{ cliente.cpf|default:'' }}"
                required
                pattern="\d{3}\.\d{3}\.\d{3}-\d{2}"
                maxlength="14"
                placeholder="000.000.000-00">
            <small style="color: #666;">Formato: XXX.XXX.XXX-XX</small>
        </div>
        
        <div class="form-group">
            <label for="email">E-mail:</label>
            <input 
                type="email" 
                id="email" 
                name="email" 
                value="{{ cliente.email|default:'' }}"
                maxlength="100"
                placeholder="exemplo@email.com">
        </div>
        
        <div class="form-group">
            <label for="telefone">Telefone:</label>
            <input 
                type="text" 
                id="telefone" 
                name="telefone" 
                value="{{ cliente.telefone|default:'' }}"
                pattern="\(\d{2}\) \d{4,5}-\d{4}"
                maxlength="20"
                placeholder="(00) 00000-0000">
            <small style="color: #666;">Formato: (XX) XXXXX-XXXX</small>
        </div>
        
        <div class="form-group">
            <div class="checkbox-group">
                <input 
                    type="checkbox" 
                    id="ativo" 
                    name="ativo"
                    {% if not cliente or cliente.ativo %}checked{% endif %}>
                <label for="ativo" style="margin: 0;">Cliente Ativo</label>
            </div>
        </div>
        
        <div class="actions">
            <button type="submit" class="btn btn-success">üíæ Salvar</button>
            <a href="{% url 'cliente_lista' %}" class="btn btn-secondary">‚Ü©Ô∏è Cancelar</a>
        </div>
    </form>
</div>

<script>
    // M√°scara para CPF
    document.getElementById('cpf').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length <= 11) {
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        }
    });
    
    // M√°scara para Telefone
    document.getElementById('telefone').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length <= 11) {
            if (value.length <= 10) {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            } else {
                value = value.replace(/(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        }
    });
    
    // Valida√ß√£o de CPF no submit
    document.querySelector('form').addEventListener('submit', function(e) {
        const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
        
        if (cpf.length !== 11) {
            e.preventDefault();
            alert('CPF deve conter 11 d√≠gitos!');
            return false;
        }
        
        // Verifica se todos os d√≠gitos s√£o iguais
        if (/^(\d)\1{10}$/.test(cpf)) {
            e.preventDefault();
            alert('CPF inv√°lido!');
            return false;
        }
    });
</script>
{% endblock %}
